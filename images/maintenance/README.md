# Maintenance OS Build Artifacts

This directory contains the assets required to build the Shoal maintenance OS bootc image and accompanying ISO.

- `Containerfile` – multi-stage build that compiles the dispatcher binary and embeds systemd units, Quadlet definitions, and wrapper scripts into a bootc base image.
- `scripts/build_maintenance_os.sh` (at repository root) – helper that builds the container image with Podman and invokes `bootc-image-builder` to produce `bootc-maintenance.iso`.

## Prerequisites

- Linux host with `podman` and the ability to run privileged containers.
- Access to `quay.io/centos-bootc/bootc-image-builder:latest` (pulls automatically if absent).
- Sufficient disk space to store the intermediate container layers and ISO output (several GB).

## Quick Start

```bash
./scripts/build_maintenance_os.sh --output /tmp/shoal-maint-os
```

The script builds `shoal-maintenance:dev` from the repository root and runs `bootc-image-builder` to emit an ISO under `/tmp/shoal-maint-os`. Use `IMAGE_NAME` or the `--image-name` flag to override the tag if you want to push to a registry.

## Customising the Build

- Override packages by editing the `microdnf install` line in the `Containerfile`.
- Drop-in additional Quadlet units or systemd services under `internal/provisioner/maintenance/` before invoking the script.
- Provide a target architecture via `--arch aarch64` when building on a different platform.

## Outputs

The ISO directory contains:

- `bootc-maintenance.iso` – bootable maintenance OS image ready for virtual media.
- `build-info.json` – metadata generated by `bootc-image-builder` describing the compose.

These artifacts should be published at a stable URL for the controller to mount during provisioning.
